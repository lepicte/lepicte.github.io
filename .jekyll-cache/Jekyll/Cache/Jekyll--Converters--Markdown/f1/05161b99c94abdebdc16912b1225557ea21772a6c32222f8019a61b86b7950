I"Ç<p>Bonjour √† tous,</p>

<p>Apr√®s m‚Äô√™tre demand√© comment lancer toutes mes commandes derri√®re un proxy <a href="https://fr.wikipedia.org/wiki/SOCKS">SOCKS</a> pour masquer mon ip (certaines commandes ne proposent pas d‚Äôoption pour rediriger vers un proxy SOCKS), vous pouvez vous en sortir gr√¢ce au r√©seau <a href="https://fr.wikipedia.org/wiki/Tor_(r%C3%A9seau)">TOR</a> et un outil appel√© <a href="https://github.com/haad/proxychains/blob/master/src/proxychains.conf">Proxychains</a>.<br />
<!--more--></p>

<p>Installez tor et proxychains:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get install tor
apt-get install proxychains
</code></pre></div></div>

<p>Tor √©coute par d√©faut sur le port <strong>9050</strong>. Editer le fichier <em>/etc/tor/torrc</em> et d√©commentez la ligne <code class="language-plaintext highlighter-rouge">SOCKSPort 9050</code>.</p>

<p>Lancer ensuite TOR as a service:  <code class="language-plaintext highlighter-rouge">service tor start</code></p>

<p>Vous pouvez v√©rifier que TOR √©coute en lan√ßant la commande <code class="language-plaintext highlighter-rouge">netstat -tulpn</code>, vous devriez voir:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Proto Recv-Q Send-Q Adresse locale          Adresse distante        Etat        PID/Program name
tcp        0      0 127.0.0.1:9050          0.0.0.0:*               LISTEN      -
</code></pre></div></div>

<p><strong>Maintenant comment linker nos commandes sur TOR?</strong></p>

<p>Proxychains va prendre en param√®tre notre commande et linker le processus vers le(s) proxy(ies) de votre choix.</p>

<blockquote>
  <p><em>ProxyChains is a UNIX program, that hooks network-related libc functions in dynamically linked programs via a preloaded DLL and redirects the
   connections through SOCKS4a/5 or HTTP proxies.</em></p>
</blockquote>

<p>Utilisation:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ProxyChains-3.1 (http://proxychains.sf.net)
	usage:
		proxychains &lt;prog&gt; [args]
</code></pre></div></div>

<p>Proxychains demande de modifier sa configuration: <code class="language-plaintext highlighter-rouge">gedit /etc/proxychains.conf</code></p>

<p>Voici ma configuration:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># proxychains.conf  VER 3.1
#
#        HTTP, SOCKS4, SOCKS5 tunneling proxifier with DNS.
#	

# The option below identifies how the ProxyList is treated.
# only one option should be uncommented at time,
# otherwise the last appearing option will be accepted
#
dynamic_chain
#
# Dynamic - Each connection will be done via chained proxies
# all proxies chained in the order as they appear in the list
# at least one proxy must be online to play in chain
# (dead proxies are skipped)
# otherwise EINTR is returned to the app
#
#strict_chain
#
# Strict - Each connection will be done via chained proxies
# all proxies chained in the order as they appear in the list
# all proxies must be online to play in chain
# otherwise EINTR is returned to the app
#
#random_chain
#
# Random - Each connection will be done via random proxy
# (or proxy chain, see  chain_len) from the list.
# this option is good to test your IDS :)

# Make sense only if random_chain
#chain_len = 2

# Quiet mode (no output from library)
quiet_mode

# Proxy DNS requests - no leak for DNS data
proxy_dns

# Some timeouts in milliseconds
tcp_read_time_out 15000
tcp_connect_time_out 8000

# ProxyList format
#       type  host  port [user pass]
#       (values separated by 'tab' or 'blank')
#
#
#        Examples:
#
#            	socks5	192.168.67.78	1080	lamer	secret
#		http	192.168.89.3	8080	justu	hidden
#	 	socks4	192.168.1.49	1080
#	        http	192.168.39.93	8080	
#		
#
#       proxy types: http, socks4, socks5
#        ( auth types supported: "basic"-http  "user/pass"-socks )
#
[ProxyList]
# add proxy here ...
# meanwile
# defaults set to "tor"
socks5 	127.0.0.1 9050
</code></pre></div></div>

<p><strong>dynamic_chain</strong>: pertinent surtout si vous chainez plusieurs proxies, les proxies down ne seront simplement pas pris en compte.<br />
<strong>quiet_mode</strong>: sortie non verbeuse.<br />
<strong>proxy_dns</strong>: demandera au proxy d‚Äôeffectuer les r√©solutions DNS (SOCKS4a et SOCKS5).<br />
<strong>tcp_read_time_out 15000, tcp_connect_time_out 8000</strong>: socket timeout.<br />
<strong>socks5 127.0.0.1 9050</strong>: ici nous utilisons le r√©seau TOR.</p>

<p>J‚Äôai eu perso une erreur du type:<br />
<code>ERROR: ld.so: object 'libproxychains.so.3' from LD_PRELOAD cannot be preloaded: ignored.</code></p>

<p>La librairie partag√©e <em>libproxychains.so.3</em> n‚Äôa pas √©t√© trouv√©e. La variable d‚Äôenvironnement <em>LD_PRELOAD</em> n‚Äôest donc pas correctement initialis√©e (variable qui permet d‚Äôeffectuer le hook des appels aux sockets).</p>

<p>Editez le fichier <em>/usr/bin/proxychains</em> et remplacez<br />
<code class="language-plaintext highlighter-rouge">export LD_PRELOAD=libproxychains.so.3</code><br />
par<br />
<code class="language-plaintext highlighter-rouge">export LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libproxychains.so.3</code>.</p>

<p>Au besoin effectuez un <code class="language-plaintext highlighter-rouge">locate libproxychains.so.3</code>.</p>

<p>Je vous dis √† tr√®s bient√¥t!</p>
:ET